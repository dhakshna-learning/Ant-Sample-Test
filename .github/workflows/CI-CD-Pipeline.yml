name: CI-CD Dev Build Pipeline (with secrets)
on:
  workflow_dispatch:  
    inputs:
      ant_target:
        description: 'Please choose the Ant Target:'
        required: true
        type: choice
        options:
          - build
          - compile
          - test
      environment:
        required: true
        type: choice
        options:
          - Dev
          - QA
permissions:
  id-token: write  
  contents: read
  issues: write

jobs:
  CI-Build:
    name: Test
    uses: dhakshna-learning/ci-cd-automation/.github/workflows/build-with-approver.yml@master
    with:
      ant_target: ${{ inputs.ant_target }}
      environment: ${{ inputs.environment }}
    secrets: inherit
 

  Upload-Artifact:
    needs: CI-Build
    name: Upload-Build_Artifact
    uses: dhakshna-learning/ci-cd-automation/.github/workflows/deploy-on-approval.yml@master
    with:
      environment: ${{ inputs.environment }}
      issue_number: ${{ needs.CI-Build.outputs.issue_number }}
      run_number: ${{ needs.CI-Build.outputs.run_number }}
    secrets: inherit

  # send-Script:
  #   needs: [CI-Build, Upload-Artifact]
  #   name: send-script
  #   uses: dhakshna-learning/ci-cd-automation/.github/workflows/centralized-script.yml@master
  #   with:
  #     ant_target: ${{ inputs.ant_target }}
  #     environment: ${{ inputs.environment }}
  #   secrets: inherit
